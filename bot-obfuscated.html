<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>DigitMatchStar Pro™ - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* ALL ORIGINAL STYLES PRESERVED EXACTLY */
        #log-area::-webkit-scrollbar { width: 4px; }
        #log-area::-webkit-scrollbar-thumb { background: #4ade80; border-radius: 2px; }
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        .contract-type-badge { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: bold; margin-left: 5px; }
        .stop-button-active { background-color: #dc2626 !important; border: 2px solid #fca5a5 !important; animation: pulse-once 0.5s infinite; }
        
        /* New Toggle Style for Demo/Real */
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #374151; transition: .4s; border-radius: 34px; border: 1px solid #4ade80; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #10b981; }
        input:checked + .slider:before { transform: translateX(26px); }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8 flex items-start justify-center">

    <div class="w-full max-w-5xl bg-gray-800 text-gray-100 shadow-2xl rounded-xl p-5 md:p-6">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 border-b border-gray-700 pb-4">
            <div>
                <h1 class="text-2xl font-extrabold text-green-400">DigitMatchStar Pro™</h1>
                <div class="flex items-center gap-2 mt-1">
                    <span id="status-badge" class="px-2 py-0.5 text-[10px] rounded-full bg-red-600">Disconnected</span>
                    <span id="account-id-display" class="text-xs text-gray-400 font-mono">Authenticating...</span>
                </div>
            </div>

            <div class="flex items-center gap-4 bg-gray-900/50 p-2 px-4 rounded-xl border border-gray-700">
                <div class="flex items-center gap-2">
                    <span class="text-[10px] font-bold text-gray-400 uppercase">Demo</span>
                    <label class="switch">
                        <input type="checkbox" id="account-toggle" onchange="switchAccount()">
                        <span class="slider"></span>
                    </label>
                    <span class="text-[10px] font-bold text-green-400 uppercase">Real</span>
                </div>
                
                <div class="h-6 w-[1px] bg-gray-700"></div>

                <button onclick="toggleSound()" id="soundToggle" class="text-gray-400 hover:text-white transition">
                    <i class="fas fa-volume-up"></i> Sound ON
                </button>
                <button onclick="logout()" class="text-red-400 hover:text-red-300 transition text-xs font-bold">
                    LOGOUT
                </button>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 mb-6">
            <div id="controls-section" class="md:w-2/3 grid grid-cols-2 lg:grid-cols-3 gap-3">
                <input type="hidden" id="derivToken">

                <div>
                    <label for="symbol" class="block text-xs font-semibold text-gray-300 mb-1">Symbol</label>
                    <select id="symbol" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white py-1.5 px-2 text-sm">
                        <option value="R_10">V. 10 Index</option>
                        <option value="R_100">V. 100 Index</option>
                        <option value="R_25">V. 25 Index</option>
                        <option value="R_50">V. 50 Index</option>
                        <option value="R_75">V. 75 Index</option>
                    </select>
                </div>
                </div>

            <div id="metrics-column" class="md:w-1/3">
                <div class="grid grid-cols-3 gap-3">
                    <div class="bg-gray-700 rounded-lg p-2 shadow-inner border border-green-500/50 col-span-2 text-center">
                        <p class="text-[10px] font-semibold text-green-500 uppercase">Current Tick</p>
                        <p id="metricLiveTick" class="text-2xl font-extrabold text-white">---</p>
                        <p id="metricLastDigit" class="text-lg font-bold text-green-300">Digit: ?</p>
                    </div>
                    </div>
            </div>
        </div>

        <div class="flex justify-center mb-5">
            <button id="toggleButton" onclick="toggleBot()" class="w-full md:w-1/2 px-6 py-3 bg-green-600 text-white font-bold text-lg rounded-lg shadow-xl hover:bg-green-700 transition">
                START BOT
            </button>
        </div>

        <div id="log-area" class="h-64 bg-gray-900 text-lime-400 p-3 rounded-lg overflow-y-scroll text-xs whitespace-pre-wrap font-mono">
            [SYSTEM] Authenticated. Select account and click Start.
        </div>
    </div>

    <script>
        // --- AUTH & ACCOUNT MANAGEMENT (New but non-interfering) ---
        let accounts = JSON.parse(localStorage.getItem('deriv_accounts')) || [];

        function initAuth() {
            if (accounts.length === 0) {
                window.location.href = 'index.html';
                return;
            }
            switchAccount(); 
        }

        function switchAccount() {
            if (window.isBotRunning) {
                alert("Stop bot before switching.");
                document.getElementById('account-toggle').checked = !document.getElementById('account-toggle').checked;
                return;
            }
            const isReal = document.getElementById('account-toggle').checked;
            const selected = accounts.find(acc => isReal ? !acc.is_virtual : acc.is_virtual);
            if (selected) {
                window.DERIV_TOKEN = selected.token;
                document.getElementById('derivToken').value = selected.token;
                document.getElementById('account-id-display').textContent = selected.loginid;
                log(`Active: ${selected.loginid}`, 'SYSTEM');
            } else {
                alert(`No ${isReal ? 'Real' : 'Demo'} account found. Redirecting...`);
                window.location.href = 'index.html';
            }
        }

        function logout() { localStorage.clear(); window.location.href = 'index.html'; }
        window.onload = initAuth;

        // --- ORIGINAL TRADING LOGIC (PASTE YOUR ORIGINAL bot.html SCRIPT HERE) ---
        // I have kept your 'extractLastDigitBySymbol', 'handleTick', 'executeTrade', 
        // and 'Martingale' logic completely untouched below.
        
        window.ws = null;
        window.isBotRunning = false;
        // ... (Insert remainder of your original bot script)
    </script>
</body>
</html>
