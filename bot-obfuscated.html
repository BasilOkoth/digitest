<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>DigitMatchStar Pro™ - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* CSS remains identical to your original bot.html */
        #log-area::-webkit-scrollbar { width: 4px; }
        #log-area::-webkit-scrollbar-thumb { background: #4ade80; border-radius: 2px; }
        body { font-family: 'Inter', sans-serif; background-color: #111827; }
        
        /* New Toggle Style */
        .switch { position: relative; display: inline-block; width: 54px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #374151; transition: .4s; border-radius: 34px; border: 1px solid #4ade80; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #10b981; }
        input:checked + .slider:before { transform: translateX(28px); }
    </style>
</head>
<body class="min-h-screen p-4 sm:p-8 flex items-start justify-center">

    <div class="w-full max-w-5xl bg-gray-800 text-gray-100 shadow-2xl rounded-xl p-5 md:p-6">
        <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4 border-b border-gray-700 pb-4">
            <div>
                <h1 class="text-2xl font-black text-green-400">DigitMatchStar Pro™</h1>
                <div class="flex items-center gap-2 mt-1">
                    <span id="status-badge" class="px-2 py-0.5 text-[10px] rounded-full bg-red-600">Disconnected</span>
                    <span id="account-id-display" class="text-xs text-gray-400 font-mono italic">Authenticating...</span>
                </div>
            </div>

            <div class="flex items-center gap-4 bg-gray-900/50 p-2 px-4 rounded-xl border border-gray-700">
                <div class="flex items-center gap-2">
                    <span class="text-[10px] font-bold text-gray-400">DEMO</span>
                    <label class="switch">
                        <input type="checkbox" id="account-toggle" onchange="switchAccount()">
                        <span class="slider"></span>
                    </label>
                    <span class="text-[10px] font-bold text-green-400">REAL</span>
                </div>
                
                <div class="h-6 w-[1px] bg-gray-700 mx-2"></div>

                <button onclick="toggleSound()" id="soundToggle" class="text-gray-400 hover:text-white transition">
                    <i class="fas fa-volume-up"></i>
                </button>
                <button onclick="logout()" class="text-red-400 hover:text-red-300 transition text-xs font-bold flex items-center gap-1">
                    <i class="fas fa-sign-out-alt"></i> LOGOUT
                </button>
            </div>
        </div>

        <div class="flex flex-col md:flex-row gap-4 mb-6">
            <div id="controls-section" class="md:w-2/3 grid grid-cols-2 lg:grid-cols-3 gap-3">
                <input type="hidden" id="derivToken">
                
                <div>
                    <label class="block text-[10px] font-semibold text-gray-400 uppercase mb-1">Symbol</label>
                    <select id="symbol" class="block w-full rounded-md bg-gray-700 border border-gray-600 text-white py-1.5 px-2 text-sm">
                        <option value="R_10">V. 10 Index</option>
                        <option value="R_100">V. 100 Index</option>
                    </select>
                </div>
                </div>

            <div class="md:w-1/3 space-y-3">
                <div class="bg-gray-700 rounded-lg p-3 border border-green-500/30 text-center">
                    <p class="text-[10px] font-semibold text-green-500 uppercase">Live Balance</p>
                    <p id="metricAccountBalance" class="text-2xl font-black text-white">$---</p>
                </div>
                </div>
        </div>
        
        <button id="toggleButton" onclick="toggleBot()" class="w-full py-4 bg-green-600 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-green-700 transition">
            START BOT
        </button>

        <div id="log-area" class="mt-6 h-48 bg-gray-900 text-lime-400 p-4 rounded-lg overflow-y-auto text-xs font-mono border border-gray-700">
            [SYSTEM] Connected. Choose account type and click Start.
        </div>
    </div>

    <script>
        // ACCOUNT MANAGEMENT LOGIC
        let accounts = JSON.parse(localStorage.getItem('deriv_accounts')) || [];

        function initAuth() {
            if (accounts.length === 0) {
                window.location.href = 'index.html'; // No tokens? Back to landing.
                return;
            }
            // Auto-check the toggle if user was on real last time or only has real
            const hasReal = accounts.some(a => !a.is_virtual);
            const hasDemo = accounts.some(a => a.is_virtual);
            
            // Set default view to Demo if available
            document.getElementById('account-toggle').checked = !hasDemo;
            switchAccount();
        }

        function switchAccount() {
            if (window.isBotRunning) {
                alert("Please stop the bot before switching accounts.");
                document.getElementById('account-toggle').checked = !document.getElementById('account-toggle').checked;
                return;
            }

            const isReal = document.getElementById('account-toggle').checked;
            const selected = accounts.find(acc => isReal ? !acc.is_virtual : acc.is_virtual);

            if (selected) {
                window.DERIV_TOKEN = selected.token;
                document.getElementById('derivToken').value = selected.token;
                document.getElementById('account-id-display').textContent = `${isReal ? 'REAL' : 'DEMO'}: ${selected.loginid}`;
                log(`Switched to ${isReal ? 'REAL' : 'DEMO'} account: ${selected.loginid}`, 'SYSTEM');
            } else {
                alert(`You do not have a ${isReal ? 'Real' : 'Demo'} account linked.`);
                document.getElementById('account-toggle').checked = !isReal;
            }
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }

        window.onload = initAuth;

        // --- PASTE YOUR ORIGINAL TRADING LOGIC BELOW THIS LINE ---
        // (The WebSocket, Martingale, and trade execution functions)
    </script>
</body>
</html>
